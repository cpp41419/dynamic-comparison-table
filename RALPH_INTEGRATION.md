# Comparison Engine - Ralph Monorepo Integration

Successfully integrated the comparison engine into your Ralph-managed monorepo!

## What Was Done

### âœ… 1. Created Comparison Engine Package

**Location:** `/Users/cappadonna/nextjs-template-extractor/packages/comparison-engine`

- Copied all comparison components, lib files, and styles
- Created `package.json` with dependencies
- Created `index.ts` for exports
- Added to workspace configuration

### âœ… 2. Updated Ralph's Site Generation

**Modified:** `scripts/generate_sites.cjs`

Ralph now automatically:
- Creates `/compare` route for every generated site
- Injects comparison engine environment variables
- Adds `@comparison-engine` workspace dependency
- Configures course-specific metadata

**New Environment Variables Added:**
```bash
NEXT_PUBLIC_SITE_URL=https://{courseCode}.com.au/compare
NEXT_PUBLIC_DEPLOYMENT_MODE=route
NEXT_PUBLIC_STATE=NSW
```

### âœ… 3. Comparison Route Template

Every generated site now gets `src/app/compare/page.tsx`:
```typescript
"use client"

import React from "react"
import HeroSection from "@/components/comparison/HeroSection"
import CourseGrid from "@/components/comparison/CourseGrid"
import Footer from "@/components/comparison/Footer"

export default function ComparePage() {
    return (
        <>
            <HeroSection />
            <CourseGrid />
            <Footer />
        </>
    )
}
```

---

## How to Use

### Generate All Sites with Comparison Engine

```bash
cd /Users/cappadonna/nextjs-template-extractor
node scripts/generate_sites.cjs
```

This will regenerate all course sites with `/compare` routes.

### Generate Specific Course Site

```bash
node scripts/generate_sites.cjs BSB40520
```

### Test the Integration

```bash
chmod +x "/Users/cappadonna/Downloads/dynamic-comparison-table 2/test-ralph-integration.sh"
bash "/Users/cappadonna/Downloads/dynamic-comparison-table 2/test-ralph-integration.sh"
```

### Build a Site

```bash
cd bsb40520-site
npm install
npm run build
```

### Deploy All Sites

```bash
./scripts/manage_network.sh deploy all
```

---

## Site-Specific SEO

Each generated site gets unique metadata:

**BSB40520 Site:**
- URL: `https://bsb40520.com.au/compare`
- Title: "Compare BSB40520 Providers | Certificate IV in Leadership and Management"
- Course Code: `BSB40520`

**CPP41419 Site:**
- URL: `https://cpp41419.com.au/compare`
- Title: "Compare CPP41419 Providers | Certificate IV in Real Estate Practice"
- Course Code: `CPP41419`

Google sees these as completely different pages!

---

## Protected Sites

**CPP41419-site** is protected and won't be regenerated by Ralph.

To add comparison engine manually:

1. Copy comparison components to `cpp41419-site/components/comparison/`
2. Create `cpp41419-site/src/app/compare/page.tsx`
3. Add environment variables to `.env.local`
4. Add `@comparison-engine` dependency to `package.json`

---

## Main-Master Hub Integration

The hub site (main-master) should show ALL courses.

**To add comparison to main-master:**

1. Create `main-master/src/app/compare/page.tsx`
2. Set `NEXT_PUBLIC_COURSE_CODE=GENERIC` in `.env.local`
3. Import comparison components
4. Add course directory component

---

## File Structure

```
nextjs-template-extractor/
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ comparison-engine/          # Shared comparison package
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ lib/
â”‚       â”œâ”€â”€ styles/
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ generate_sites.cjs          # âœ… Updated with comparison injection
â”œâ”€â”€ main-master/                    # Hub site (TODO: add comparison)
â”œâ”€â”€ bsb40520-site/                  # âœ… Auto-generated with /compare
â”‚   â”œâ”€â”€ src/app/compare/
â”‚   â”‚   â””â”€â”€ page.tsx                # âœ… Comparison route
â”‚   â”œâ”€â”€ .env.local                  # âœ… Comparison env vars
â”‚   â””â”€â”€ package.json                # âœ… @comparison-engine dependency
â”œâ”€â”€ chc33021-site/                  # âœ… Auto-generated with /compare
â”œâ”€â”€ cpp41419-site/                  # âš ï¸  Protected (manual integration needed)
â””â”€â”€ ... (all other course sites)    # âœ… Auto-generated with /compare
```

---

## Verification Checklist

After running `node scripts/generate_sites.cjs`:

- [ ] Check `{course}-site/src/app/compare/page.tsx` exists
- [ ] Verify `.env.local` contains `NEXT_PUBLIC_SITE_URL`
- [ ] Confirm `package.json` includes `@comparison-engine`
- [ ] Build a test site: `cd bsb40520-site && npm install && npm run build`
- [ ] Verify unique metadata in page source
- [ ] Check Schema.org markup includes course code

---

## Deployment Workflow

### 1. Regenerate All Sites
```bash
node scripts/generate_sites.cjs
```

### 2. Build All Sites
```bash
./scripts/manage_network.sh build all
```

### 3. Deploy All Sites
```bash
./scripts/manage_network.sh deploy all
```

### 4. Verify Live Sites
- Visit `https://bsb40520.com.au/compare`
- Check page source for unique metadata
- Verify comparison functionality works

---

## Troubleshooting

### Comparison components not found

**Solution:** Ensure workspace dependencies are installed:
```bash
npm install
```

### Build errors in generated sites

**Solution:** Check that comparison engine package is properly linked:
```bash
cd bsb40520-site
npm install
npm list @comparison-engine
```

### Environment variables not loading

**Solution:** Restart dev server after regenerating:
```bash
cd bsb40520-site
npm run dev
```

### Wrong metadata showing

**Solution:** Verify `NEXT_PUBLIC_COURSE_CODE` in `.env.local` matches the course:
```bash
grep NEXT_PUBLIC_COURSE_CODE bsb40520-site/.env.local
```

---

## Next Steps

1. **Test Generation:**
   ```bash
   bash "/Users/cappadonna/Downloads/dynamic-comparison-table 2/test-ralph-integration.sh"
   ```

2. **Add to Main-Master:**
   - Create comparison route for hub site
   - Configure GENERIC mode
   - Add course directory

3. **Manual CPP41419 Integration:**
   - Copy comparison components
   - Create `/compare` route
   - Add environment variables

4. **Deploy Network:**
   ```bash
   ./scripts/manage_network.sh deploy all
   ```

---

## Summary

âœ… **Comparison engine package created**
âœ… **Ralph auto-injects /compare routes**
âœ… **Unique SEO per course site**
âœ… **Workspace dependencies configured**
âœ… **Environment variables automated**

**All course sites now get comparison functionality automatically when generated by Ralph!** ğŸš€
